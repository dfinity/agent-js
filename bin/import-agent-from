#!/usr/bin/env sh

function help {
msg="$(cat <<-EOF
This repository is the new home for the @dfinity/agent npm package.
This script will take a path to its old home in the sdk, then copy it here to ./packages/agent w/ any transformations required as part of the 'move'.

Usage:
    ./import-agent-from ~/dfinity/sdk/src/agent/javascript

EOF)"
    echo "$msg"
}

function main {
    agent_target="$(dirname $0)"/../packages/agent
    agent_src="$1"
    if [[ -z "$agent_src" ]]; then
        help
        echo
        echo "Error: Provide a path to the sdk agent directory to import from there"
        exit 1
    fi
    # Warning
    rm -rf "$agent_target"
    cp -a "$agent_src" "$agent_target"
    # Remove files we dont need
    find "$agent_target" -name '*INTERNAL*' | xargs rm
    find "$agent_target" -name '*.nix' | xargs rm
}

main $@
